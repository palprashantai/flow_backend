1. CREATE TABLE `tbl_subscriber_acceptance` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `subscriberid` INT NOT NULL,
  `accepted_on` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `source` TINYINT NOT NULL COMMENT '1 - Website Payment Agreement / 2 - Website - Client Acceptance Page / 3 - Current Mobile App / 4 - Folio App',
  `created_on` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  INDEX `idx_subscriberid` (`subscriberid`),
  CONSTRAINT `fk_subscriber_acceptance_subscriber`
    FOREIGN KEY (`subscriberid`) REFERENCES `tbl_subscriber` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE `tbl_app_folio` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `subscriberid` INT NOT NULL,
  `token` VARCHAR(255) NOT NULL,
  `deviceid` VARCHAR(255) NOT NULL,
  `created_on` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_subscriberid` (`subscriberid`),
  CONSTRAINT `fk_appfolio_subscriber`
    FOREIGN KEY (`subscriberid`) 
    REFERENCES `tbl_subscriber`(`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

CREATE TABLE `tbl_app_trades` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `subscriberid` INT NOT NULL,
  `token` VARCHAR(255) NOT NULL,
  `deviceid` VARCHAR(255) NOT NULL,
  `created_on` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_subscriberid` (`subscriberid`),
  CONSTRAINT `fk_apptrades_subscriber`
    FOREIGN KEY (`subscriberid`) 
    REFERENCES `tbl_subscriber`(`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;


    CREATE TABLE `tbl_log_streetfolio_events` (
     `id` INT NOT NULL AUTO_INCREMENT,
     `screen_name` VARCHAR(255) DEFAULT NULL,
     `event_type` VARCHAR(100) DEFAULT NULL,
     `subscriberid` INT DEFAULT NULL,
    `created_on` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;


CREATE TABLE IF NOT EXISTS `tbl_referral_info_folio` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `referral_id` INT NOT NULL,
  `referral_code` VARCHAR(15) DEFAULT NULL,
  `sub_id` INT DEFAULT 0,
  `amount` INT DEFAULT 0,
  `status` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '0 - Installed / 1 - Purchased',
  `updated_on` DATETIME DEFAULT NULL,
  `datetime` DATETIME DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;


CREATE TABLE IF NOT EXISTS `tbl_wallet_folio` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `subscriberid` INT NOT NULL DEFAULT 0,
  `referid` INT NOT NULL DEFAULT 0,
  `amount` DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  `type` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '0 - Credit / 1 - Debit',
  `created_on` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


ALTER TABLE streetgains.tbl_configuration
ADD COLUMN referral_amount DECIMAL(10,2) NOT NULL DEFAULT 100;


ALTER TABLE streetgains.tbl_offers
ADD COLUMN planid VARCHAR(50) NULL AFTER id;


ALTER TABLE streetgains.tbl_subscriber MODIFY COLUMN authid VARCHAR(50) NULL DEFAULT NULL;

ALTER TABLE streetgains.tbl_services
ADD COLUMN access_price_monthly DECIMAL(10,2) NOT NULL DEFAULT 0.00,
ADD COLUMN service_banner VARCHAR(255) DEFAULT NULL AFTER access_price_monthly;

ALTER TABLE streetgains.tbl_subscriber
ADD COLUMN broker VARCHAR(255) NULL AFTER email;

CREATE TABLE streetgains.tbl_broker ( id INT UNSIGNED NOT NULL AUTO_INCREMENT, name VARCHAR(255) NOT NULL, icon_url VARCHAR(500) DEFAULT NULL, created_on TIMESTAMP DEFAULT CURRENT_TIMESTAMP, PRIMARY KEY (id) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


ALTER TABLE streetgains.tbl_broker
ADD COLUMN slug VARCHAR(100) NULL AFTER name;

INSERT INTO streetgains.tbl_broker (name, icon_url) 
VALUES
('Groww', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/fda16cce4a9e43fbbca296f860b5d199.jpg'),
('Zerodha', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/06e5b0495f954efb99a33ceda18aec79.jpg'),
('Angel One', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/logos/93924e21b8cb4b4cb8807a05bbc3411c.jpg'),
('HDFC Securities', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/logos/72c31747eaff4892a42266fe167bd422.jpg'),
('Axis Direct', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/logos/c408d45eb829481f9415cfda4a7f67f8.jpg'),
('Upstox', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/logos/a98be00544cd42dea492dfaf0ecc14c5.jpg'),
('5paisa', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/439f87d1c32e4a4a98b8d32c281677bb.jpg'),
('Kotak Securities', 'https://s3.ap-south-1.amazonaws.com/finology-images/Select/e1997dc85127420da395a8f01d0d6861.jpg');


UPDATE streetgains.tbl_broker SET slug = 'groww' WHERE name = 'Groww';
UPDATE streetgains.tbl_broker SET slug = 'kite' WHERE name = 'Zerodha';
UPDATE streetgains.tbl_broker SET slug = 'angelbroking' WHERE name = 'Angel One';
UPDATE streetgains.tbl_broker SET slug = 'hdfc' WHERE name = 'HDFC Securities';
UPDATE streetgains.tbl_broker SET slug = 'axis' WHERE name LIKE 'Axis%';
UPDATE streetgains.tbl_broker SET slug = 'upstox' WHERE name = 'Upstox';
UPDATE streetgains.tbl_broker SET slug = 'fivepaisa' WHERE name LIKE '5Paisa%';
UPDATE streetgains.tbl_broker SET slug = 'kotak' WHERE name LIKE 'Kotak%';



DROP TABLE IF EXISTS streetgains.tbl_log_streetfolio_events;

CREATE TABLE streetgains.tbl_log_streetfolio_events (
  id INT AUTO_INCREMENT PRIMARY KEY,
  screen_name VARCHAR(255) NULL,
  event_type VARCHAR(255) NULL,
  subscriberid INT NOT NULL DEFAULT 0,
  device_id VARCHAR(255) NULL,
  payload TEXT NULL,
  created_on DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  INDEX idx_subscriberid (subscriberid),
  INDEX idx_device_id (device_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

ALTER TABLE streetgains.tbl_services_sub
ADD COLUMN discount_code VARCHAR(100) NULL AFTER discount_price;


ALTER TABLE streetgains.tbl_services_sub
ADD COLUMN access_price_monthly DECIMAL(10,2) DEFAULT 0 AFTER credits_price;


ALTER TABLE streetgains.tbl_subscription
ADD COLUMN invest_status TINYINT(1) NOT NULL DEFAULT 0
COMMENT '0 = Successfully Subscribed | 1 = Successfully Invested | 2 = Rebalance Required | 3 = Rebalanced Successfully';


ALTER TABLE streetgains.tbl_subscriber_events
ADD COLUMN planid INT NOT NULL DEFAULT 0;



ALTER TABLE tbl_razorpay_order
ADD COLUMN discount_code VARCHAR(100) NULL AFTER existing_column_name,
ADD COLUMN discount_price DECIMAL(10,2) DEFAULT 0 AFTER discount_code,
ADD COLUMN credits_price DECIMAL(10,2) DEFAULT 0 AFTER discount_price,
ADD COLUMN planid INT NULL AFTER credits_price;


ALTER TABLE streetgains.tbl_services
MODIFY COLUMN discount_price_monthly INT NOT NULL DEFAULT 0;

ALTER TABLE streetgains.tbl_services_sub
MODIFY COLUMN    INT NOT NULL DEFAULT 0;

ALTER TABLE streetgains.tbl_subscriber
ADD COLUMN folio_deviceid VARCHAR(255) DEFAULT NULL AFTER deviceid;